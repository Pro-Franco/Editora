{% extends "base.html" %} {% block content %}
<h2>Livros</h2>
<a class="btn" href="/livros/novo">+ Novo Livro</a>

{% if livros.items %}
<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Título</th>
      <th>ISBN</th>
      <th>Data de Publicação</th>
      <th>Gênero</th>
      <th>Ações</th>
    </tr>
  </thead>
  <tbody>
    {% for livro in livros.items %}
    <tr>
      <td>{{ livro.livro_id }}</td>
      <td>{{ livro.titulo }}</td>
      <td>{{ livro.isbn }}</td>
      <td>{{ livro.data_publicacao or '-' }}</td>
      <td>{{ livro.genero or '-' }}</td>
      <td>
        <div class="action-buttons">
          <a href="/livros/{{ livro.livro_id }}/editar" class="btn-edit">Editar</a>
          <form
            method="POST"
            action="/livros/{{ livro.livro_id }}/deletar"
            class="form-inline"
          >
           <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn-delete" onclick="return confirm('Tem certeza?')">
              Deletar
            </button>
          </form>
        </div>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Paginação -->
<div class="pagination-container">
    <div class="pagination-info">
        <span class="pagination-text">Mostrando <strong>{{ livros.items|length }}</strong> de <strong>{{ livros.total }}</strong> livros</span>
    </div>
    
    <div class="pagination-controls">
        {# Primeira página #}
        <a class="pagination-btn {% if not livros.has_prev %}disabled{% endif %}" 
           href="{{ url_for('listar_livros', pagina=1, por_pagina=livros.per_page) }}">
            &laquo;&laquo;
        </a>

        {# Página anterior #}
        <a class="pagination-btn {% if not livros.has_prev %}disabled{% endif %}" 
           href="{{ url_for('listar_livros', pagina=livros.prev_num, por_pagina=livros.per_page) }}">
            &laquo;
        </a>

        {# Números das páginas #}
        {% for page_num in livros.iter_pages(left_edge=1, left_current=1, right_current=1, right_edge=1) %}
            {% if page_num %}
                {% if page_num == livros.page %}
                    <span class="pagination-page active">{{ page_num }}</span>
                {% else %}
                    <a class="pagination-page" 
                       href="{{ url_for('listar_livros', pagina=page_num, por_pagina=livros.per_page) }}">
                        {{ page_num }}
                    </a>
                {% endif %}
            {% else %}
                <span class="pagination-ellipsis">...</span>
            {% endif %}
        {% endfor %}

        {# Próxima página #}
        <a class="pagination-btn {% if not livros.has_next %}disabled{% endif %}" 
           href="{{ url_for('listar_livros', pagina=livros.next_num, por_pagina=livros.per_page) }}">
            &raquo;
        </a>

        {# Última página #}
        <a class="pagination-btn {% if not livros.has_next %}disabled{% endif %}" 
           href="{{ url_for('listar_livros', pagina=livros.pages, por_pagina=livros.per_page) }}">
            &raquo;&raquo;
        </a>
    </div>

    <div class="pagination-config">
        <span class="page-info">Pág. {{ livros.page }}/{{ livros.pages }}</span>
        <select class="page-select" onchange="mudarItensPorPagina(this.value)">
            <option value="5" {% if livros.per_page == 5 %}selected{% endif %}>5</option>
            <option value="10" {% if livros.per_page == 10 %}selected{% endif %}>10</option>
            <option value="20" {% if livros.per_page == 20 %}selected{% endif %}>20</option>
            <option value="50" {% if livros.per_page == 50 %}selected{% endif %}>50</option>
        </select>
    </div>
</div>

<script>
function mudarItensPorPagina(valor) {
    const url = new URL(window.location.href);
    url.searchParams.set('por_pagina', valor);
    url.searchParams.set('pagina', 1);
    window.location.href = url.toString();
}
</script>

<style>
/* Estilos para os botões de ação */
.action-buttons {
    display: flex;
    gap: 8px;
    align-items: center;
}

.btn-edit {
    padding: 6px 12px;
    background-color: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-size: 14px;
    border: none;
    cursor: pointer;
    transition: background-color 0.2s;
}

.btn-new {
    padding: 6px 12px;
    background-color: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-size: 14px;
    border: none;
    cursor: pointer;
    transition: background-color 0.2s;
}

.btn-edit:hover {
    background-color: #0056b3;
}

.btn-delete {
    padding: 6px 12px;
    background-color: #dc3545;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.btn-delete:hover {
    background-color: #c82333;
}

.form-inline {
    display: inline;
    margin: 0;
}

/* Estilos da paginação */
.pagination-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
    padding: 15px;
    background-color: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    flex-wrap: wrap;
    gap: 15px;
}

.pagination-info {
    flex: 1;
    min-width: 200px;
}

.pagination-text {
    font-size: 14px;
    color: #495057;
}

.pagination-controls {
    display: flex;
    align-items: center;
    gap: 5px;
    flex-wrap: wrap;
    justify-content: center;
}

.pagination-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    background: white;
    color: #007bff;
    text-decoration: none;
    font-weight: bold;
    font-size: 14px;
    transition: all 0.2s ease;
}

.pagination-btn:hover:not(.disabled) {
    background-color: #007bff;
    color: white;
    border-color: #007bff;
}

.pagination-btn.disabled {
    color: #6c757d;
    background-color: #f8f9fa;
    border-color: #dee2e6;
    cursor: not-allowed;
    opacity: 0.6;
}

.pagination-page {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    background: white;
    color: #495057;
    text-decoration: none;
    font-size: 14px;
    transition: all 0.2s ease;
}

.pagination-page:hover {
    background-color: #e9ecef;
    border-color: #adb5bd;
}

.pagination-page.active {
    background-color: #007bff;
    color: white;
    border-color: #007bff;
    font-weight: bold;
}

.pagination-ellipsis {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    color: #6c757d;
    font-size: 14px;
}

.pagination-config {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
    justify-content: flex-end;
    min-width: 200px;
}

.page-info {
    font-size: 14px;
    color: #495057;
    white-space: nowrap;
}

.page-select {
    padding: 6px 10px;
    border: 1px solid #ced4da;
    border-radius: 6px;
    background-color: white;
    font-size: 14px;
    min-width: 70px;
}

/* Responsividade */
@media (max-width: 768px) {
    .pagination-container {
        flex-direction: column;
        text-align: center;
        gap: 15px;
    }
    
    .pagination-info,
    .pagination-config {
        justify-content: center;
        min-width: auto;
    }
    
    .pagination-controls {
        order: 2;
    }
    
    .pagination-info {
        order: 1;
    }
    
    .pagination-config {
        order: 3;
        flex-direction: column;
        gap: 8px;
    }
    
    .action-buttons {
        flex-direction: column;
        gap: 5px;
    }
}

@media (max-width: 480px) {
    .pagination-btn,
    .pagination-page {
        width: 32px;
        height: 32px;
        font-size: 12px;
    }
    
    .pagination-text,
    .page-info {
        font-size: 13px;
    }
    
    .btn-edit,
    .btn-new,
    .btn-delete {
        padding: 4px 8px;
        font-size: 12px;
    }
}
</style>

{% else %}
<p>Nenhum livro cadastrado. <a class="btn-new" href="/livros/novo">Criar primeiro livro</a></p>
{% endif %} {% endblock %}