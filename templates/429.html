<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Muitas Requisi√ß√µes - Editora/Livraria</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        color: #333;
      }

      .error-container {
        background: white;
        padding: 50px;
        border-radius: 15px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        text-align: center;
        max-width: 500px;
        width: 100%;
        animation: fadeIn 0.6s ease;
      }

      .error-icon {
        font-size: 80px;
        margin-bottom: 20px;
        animation: bounce 2s infinite;
      }

      .error-title {
        font-size: 2.5em;
        color: #dc3545;
        margin-bottom: 15px;
        font-weight: 700;
      }

      .error-subtitle {
        font-size: 1.3em;
        color: #495057;
        margin-bottom: 20px;
        font-weight: 600;
      }

      .error-message {
        color: #6c757d;
        margin-bottom: 30px;
        line-height: 1.6;
        font-size: 1.1em;
      }

      .error-details {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 30px;
        border-left: 4px solid #dc3545;
      }

      .detail-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        padding-bottom: 8px;
        border-bottom: 1px solid #e9ecef;
      }

      .detail-label {
        font-weight: 600;
        color: #495057;
      }

      .detail-value {
        color: #dc3545;
        font-weight: 600;
      }

      .countdown {
        font-size: 1.2em;
        color: #dc3545;
        font-weight: bold;
        margin: 20px 0;
      }

      .action-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .btn {
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        transition: all 0.3s ease;
        display: inline-block;
      }

      .btn-primary {
        background: #667eea;
        color: white;
      }

      .btn-primary:hover {
        background: #5a6fd8;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
      }

      .retry-info {
        margin-top: 20px;
        padding: 15px;
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        color: #856404;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-10px);
        }
        60% {
          transform: translateY(-5px);
        }
      }

      @media (max-width: 480px) {
        .error-container {
          padding: 30px 20px;
        }

        .error-title {
          font-size: 2em;
        }

        .action-buttons {
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="error-container">
      <div class="error-icon">üö´</div>

      <h1 class="error-title">Muitas Requisi√ß√µes</h1>
      <h2 class="error-subtitle">Calma a√≠! Voc√™ est√° muito r√°pido</h2>

      <p class="error-message">
        Voc√™ excedeu o limite de requisi√ß√µes permitidas. Isso ajuda a proteger
        nosso sistema contra uso excessivo.
      </p>

      <div class="error-details">
        <div class="detail-item">
          <span class="detail-label">Seu IP:</span>
          <span class="detail-value" id="user-ip"
            >{{ request.remote_addr }}</span
          >
        </div>
        <div class="detail-item">
          <span class="detail-label">Limite:</span>
          <span class="detail-value">{{ limit }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Tempo de espera:</span>
          <span class="detail-value" id="wait-time"
            >{{ retry_after }} segundos</span
          >
        </div>
      </div>

      <div class="countdown" id="countdown">
        Pode tentar novamente em:
        <span id="timer">{{ retry_after }}</span> segundos
      </div>

      <div class="retry-info">
        <strong>üí° Dica:</strong> Aguarde um pouco antes de tentar novamente.
        Isso √© uma medida de seguran√ßa normal.
      </div>

      <div class="action-buttons">
        <button
          onclick="window.location.reload()"
          class="btn btn-primary"
          id="retry-btn"
          disabled
        >
          Tentar Novamente
        </button>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">
          Voltar ao In√≠cio
        </a>
        <a href="{{ url_for('login') }}" class="btn btn-secondary">
          P√°gina de Login
        </a>
      </div>
    </div>

    <script>
      // Contador regressivo
      let timeLeft = {{ retry_after }};
      const timerElement = document.getElementById('timer');
      const retryButton = document.getElementById('retry-btn');
      const countdownElement = document.getElementById('countdown');

      function updateTimer() {
          timerElement.textContent = timeLeft;

          if (timeLeft <= 0) {
              countdownElement.innerHTML = ' <strong>Pode tentar novamente agora!</strong>';
              retryButton.disabled = false;
              retryButton.innerHTML = ' Tentar Novamente';
              clearInterval(timerInterval);
          } else {
              timeLeft--;
          }
      }

      const timerInterval = setInterval(updateTimer, 1000);

      // Atualiza o bot√£o quando o tempo acabar
      retryButton.addEventListener('click', function() {
          if (!this.disabled) {
              this.innerHTML = 'Carregando...';
              this.disabled = true;
              setTimeout(() => {
                  window.location.reload();
              }, 1000);
          }
      });

      // Mostra informa√ß√µes de debug no console
      console.log('Rate Limit Exceeded');
      console.log('IP:', '{{ request.remote_addr }}');
      console.log('Limit:', '{{ limit }}');
      console.log('Retry After:', '{{ retry_after }} segundos');
      console.log('Path:', '{{ request.path }}');
    </script>
  </body>
</html>
